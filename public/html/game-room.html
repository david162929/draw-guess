<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <meta charset= "utf-8"></meta>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
		<title>draw-board</title>
		<link rel="stylesheet" href="static/css/normalize.css">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link rel="stylesheet" href="static/css/style.css">
		<link rel="stylesheet" href="static/css/game-room.css">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
		<style>
			
		</style>
    </head>
    <body>
		<div class="monitor">
			<h1>Wellcome to Draw-guess!</h1>
			<h3>網站在線人數： <span id="onlineCount"></span></h3>
			<h3>房間在線人數： <span id="onlineCount-room"></span></h3>
			<h3>玩家名稱： <span id="user-name">訪客</span></h3>
			<label>更改：</label>
			<input type="text" id="user-name-input">
			<button id="changeUserName" onclick="changeUserName();">確定</button>
			<h3>房號： <span id="roomId">room_1</span></h3>
			<label>前往：</label>
			<input type="text" id="roomIdNew">
			<button id="joinRoom" onclick="joinRoom();">Go</button>
		</div>

		<h3 class="info">Turn： <span id="userCurrentTurn">Waiting</span></h3>
		
		<div id="topic" class="info"></div>
		<div id="game-start" class="info"></div>

		<div class="content-1">

			<div id="ranking-list" class="ranking-list"></div>
			
			
			<div class="draw-board">
				<canvas id="cvs" width="500" height="380"></canvas>
				<div id="outer-timer">
					<div id="timer" class="draw-timer-end"></div>
				</div>
				<div class="tool-bar">
					<div id="color-set" class="">

					</div>
					<div class="div2">
						<input id="color-picker" type="color" onchange="pickColor();">
						<div id="eraser"><i class="fas fa-eraser"></i></div>
						<!-- <div id="clear-all">Clear all</div> -->
					</div>
					<div class="">
						<label><i class="fas fa-pencil-alt"></i></label>
						<input id="line-width-bar" type="range" name="points" min="1" max="10" value="2">
					</div>
				</div>
			</div>
			
			<!-- <div class="container"> -->
				<div class="chatBox">
					<div id="chat-content">
						
					</div>
					<div id="send-content">
						<form id="chat-form">
							<input type="text" name="msg" id="chat-input" placeholder="Answer here." autocomplete="off">
						</form>
					</div>
				</div>
			<!-- </div> -->
			<!-- class="container" -->
		</div><!-- class="content-1" -->
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	</body>

    <script src="/socket.io/socket.io.js"></script>
	<script src="/static/js/socket-frontend.js"></script>
	<script src="/static/js/draw-board.js"></script>
	<script>
		//Press Enter to send
		const chatForm = document.getElementById("chat-form");
		chatForm.addEventListener("submit", (event) => {
			event.preventDefault();
			if(document.getElementById("chat-input").value !== "") {
				sendMessage();
			}
		})

		//View message
		function appendMessage(tagId, userName, msg, msgClass) {
			const div = document.createElement("div");
			const spanName = document.createElement("span");
			spanName.className = "chat-user";
			const spanMessage = document.createElement("span");
			spanMessage.className = msgClass;
			const userText = document.createTextNode(userName + " : ");
			const msgText = document.createTextNode(msg);

			spanName.appendChild(userText);
			spanMessage.appendChild(msgText);
			div.appendChild(spanName);
			div.appendChild(spanMessage);
			document.getElementById(tagId).appendChild(div);

			//保持滾動在底部
			const chatContent = document.getElementById("chat-content");
			chatContent.scrollTop = chatContent.scrollHeight;
		}

		function changeUserName() {
			userName = document.getElementById("user-name-input").value;
			document.getElementById("user-name").innerHTML = userName;
			draw.emit("change-user-id", userName);			
		}

		function joinRoom () {
			lastRoomId = roomId;
			roomId = document.getElementById("roomIdNew").value;
			document.getElementById("roomId").innerHTML = roomId;
			console.log(lastRoomId, roomId);
			draw.emit("join-room", lastRoomId, roomId);
		}
		function sendMessage () {
			let msg = document.getElementById("chat-input").value;
			document.getElementById("chat-input").value = "";
			console.log(msg);
			if (gameStatus === "freeze") {
				console.log("freeze");
				draw.emit("send-answer-message", roomId, userName, msg);
			}
			else {
				console.log("other");
				draw.emit("send-chat-message", roomId, userName, msg);
			}
		}

		//使用 cookie 當中的資訊幫使用者做加入房間跟改名
		setTimeout(() => {
			userName = document.cookie.replace(/(?:^|.*;\s*)playerId\s*\=\s*([^;]*).*$|^.*$/, "$1");
			document.getElementById("user-name").innerHTML = userName;
			draw.emit("change-user-id", userName);

			roomId = document.cookie.replace(/(?:^|.*;\s*)roomId\s*\=\s*([^;]*).*$|^.*$/, "$1");
			document.getElementById("roomId").innerHTML = roomId;
			draw.emit("join-room", lastRoomId, roomId);
		}, 1000);


		//動態 append color set
		(function () {
			const color = [
				"#000000",
				"#FFFFFF",
				"#D3D3D3",
				"#808080",
				"#800000",
				"#FF0000",
				"#FF8C00",
				"#FFD700",
				"#00FF00",
				"#228B22",
				"#0000CD",
				"#00BFFF",
				"#FFC0CB",
				"#EE82EE",
				"#8A2BE2",
				"#8B4513",
				"#800080",
				"#8FBC8F"
			];
			for (let i=0; i<color.length ;i++) {
				const div = document.createElement("div");
				div.className = `square color${i}`;
				div.style = `background-color:${color[i]};`;
				document.getElementById("color-set").appendChild(div);
				div.addEventListener("click", () => {
					draw.emit("change-color", color[i]);
					draw.emit("change-line-width", document.getElementById("line-width-bar").value);
				});
			}
		})();

		//自訂顏色
		function pickColor () {
			draw.emit("change-color", document.getElementById("color-picker").value);
			draw.emit("change-line-width", document.getElementById("line-width-bar").value);
		}

		//橡皮擦
		document.getElementById("eraser").addEventListener("click", () => {
			draw.emit("change-color", "#ffffff");
			draw.emit("change-line-width", 20);
		});

		//清除全部


		//畫筆粗細
		document.getElementById("line-width-bar").addEventListener("change", () => {
			draw.emit("change-line-width", document.getElementById("line-width-bar").value);
		});
	</script>

</html>